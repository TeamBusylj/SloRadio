<!DOCTYPE html>
<html>

<head>
    <title>Cross word Puzzel</title>
</head>

<body onload="randomWords();">
    <div id="leftBox">
        <table id="puzzel">

        </table>
    </div>

    <table id="crossword">

    </table>
    <p id="times"></p>
    <div style="display: none;" id="hints"></div>
    <button onclick="randomWords(); scrptRun = 0; noOfPre  = 0;">Create</button>
    <button onclick="check()">Check</button>
    <button onclick="solve()">Solve</button>
    <!--<input type="number" style="width: auto !important;" id="chngGrid" placeholder="Grid size"></input>
    <input type="number" style="width: auto !important;" id="chngWord" placeholder="Word number"></input>-->
</body>
<script>
    var gridSize = 15;
    var wordNumber = 10
    var words = [['s', 'zdravnik'], ['Prestolnica stajerske', 'maribor'], ['Narejena iz sadja', 'marmelada'], ['Najbližja zvezda', 'sonce'], ['studiranje', 'razmisljanje'], ['Glavno mesto rusije', 'Moskva'], ['d', 'Racunalnik'], ['d', 'Vesolje'], ['d', 'Glad'], ['d', 'Dinar'], ['d', 'Aristokrat'], ['d', 'Ateist'], ['d', 'Utrinek'], ['Pretiti', 'Groziti'], ['Adam in...', 'Eva'], ['d', 'Udobni'], ['d', 'Mutant'], ['Nemška reka', 'Ren']];
    var items = []
   var scrptRun = 0
   var noOfPre  = 0
   /*
   document.getElementById("chngGrid").addEventListener("input", function(e){
    gridSize = e.srcElement.value
   })
   document.getElementById("chngWord").addEventListener("input", function(e){
    wordNumber = e.srcElement.value
   })
   */
    function checkWordPlacement(word, row, col, deltaRow, deltaCol, cross) {
        // Check if the word can be placed at the specified position and direction
        let intersectingLetter = '';
        for (let i = 0; i < word.length; i++) {
            let newRow = row + i * deltaRow;
            let newCol = col + i * deltaCol;

            if (
                newRow < 0 || newRow >= gridSize || newCol < 0 || newCol >= gridSize ||
                (items[newRow][newCol] !== '0' && items[newRow][newCol] !== word[i].toUpperCase())
            ) {
                if(cross == 0){
            return false
        } 
            } else if (items[newRow][newCol] === word[i].toUpperCase()) {
                intersectingLetter += word[i].toUpperCase();
            } 
        }
        if(cross == 0){
            return intersectingLetter || true;
        } else{
            return intersectingLetter;
        }
       
    }
    function shuffle(array) {
        let currentIndex = array.length, randomIndex;

        // While there remain elements to shuffle.
        while (currentIndex != 0) {

            // Pick a remaining element.
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;

            // And swap it with the current element.
            [array[currentIndex], array[randomIndex]] = [
                array[randomIndex], array[currentIndex]];
        }

        return array;
    }

    function randomWords() {
   
        scrptRun++
        items = []
        for (let i = 0; i < gridSize; i++) {
        items.push(Array(gridSize).fill('0'));
    }
    if(scrptRun>99){
        let table = document.getElementById("crossword");
        table.innerHTML=""
        let scriptData = document.getElementById("times");
        scriptData.innerHTML = "<b>Uh, that didn't work...</b><br> you chosed too much words for too small grid. Either try again or change the numbers.<br> The script repeated <b>" + scrptRun+"</b> times, with total of <b>" + noOfPre.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ", ")+"</b> word repositions."
        return
    }
        const placedWords = []; // Track the words that have already been placed
        const placedWordsDesc = [];
        words = shuffle(words)
     
        for (let a = 0; a < wordNumber; a++) {


            let word = " " + words[a][1] + " "
           
            let isHorizontal = Math.random() >= 0.5; // Randomly choose horizontal or vertical placement
            let row, col;
            let intersectingLetter = '';
           
            let rpt = 0
            let usedSpotsrow = []
            let usedSpotscolumn = []
            while (true) {
             noOfPre++
                row = Math.floor(Math.random() * gridSize);
                while (usedSpotsrow.includes(row)) {
                    row = Math.floor(Math.random() * gridSize);
                }
                col = Math.floor(Math.random() * gridSize);
                while (usedSpotsrow.includes(col)) {
                    col = Math.floor(Math.random() * gridSize);
                }

                if (isHorizontal && col + word.length <= gridSize - 1) {
                    intersectingLetter = checkWordPlacement(word, row, col, 0, 1, 0);
                    let isCross = checkWordPlacement(word, row, col, 0, 1, 1);
                    isCross.replace(/ /g,"")
                
                    if (intersectingLetter !== false  ) {
                        if(isCross.length>0 && isCross!== " "|| placedWords.length<1){
    
                      // items[row][col] = placedWords.length;
                        for (let i = 0; i < word.length; i++) {
                            items[row][col + i] = word[i].toUpperCase();
                        }
                        placedWords.push(word);
                        placedWordsDesc.push(words[a][0]); // Track the placed word
                        break;
                    }
                    }
                } else if (!isHorizontal && row + word.length <= gridSize - 1) {
                    intersectingLetter = checkWordPlacement(word, row, col, 1, 0, 0);
                    let isCross = checkWordPlacement(word, row, col, 1, 0, 1);
                    isCross.replace(/ /g,"")
                   ;
                       
                    if (intersectingLetter !== false  || placedWords.length<1) {
                        if(isCross.length>0 && isCross!== " "|| placedWords.length<1){
                             
                       
                        for (let i = 0; i < word.length; i++) {
                            items[row + i][col] = word[i].toUpperCase();
                        }
                        placedWords.push(word); // Track the placed word
                        placedWordsDesc.push(words[a][0])
                        break;
                    }
                    }

                }
                if (rpt > 2000) {
                    isHorizontal = !isHorizontal
                }
                if (rpt > 4000) {
                    break
                    console.log("nope");
                }
                
                rpt++
            }
          
        };

var hints = document.getElementById("hints");
for (let i = 0; i < placedWords.length; i++) {
  
    hints.innerHTML += "<br>"+i+placedWordsDesc[i]
    
}
        if(placedWords.length > wordNumber-1){
        generateCrossword();} else{
            randomWords()
        }
    }




    function generateCrossword() {
        console.log('Done')
        var table = document.getElementById("crossword");
        var scriptData = document.getElementById("times");
     scriptData.innerHTML = "The script repeated <b>" + scrptRun+"</b> times, with total of <b>" + noOfPre.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ", ")+"</b> word repositions."
        table.innerHTML=""

        items.forEach(function (row, rowIndex) {
            let tr = document.createElement("tr");
            table.appendChild(tr);
            row.forEach(function (oneLetter, colIndex) {
                let td = document.createElement("td");
                let input;
                if (oneLetter === '0' || items[rowIndex][colIndex] == " ") {
                    input = document.createElement("div");
                    input.classList.add("blank");
                } else {
                    input = document.createElement("input");
                    input.maxLength = "1";

                    input.addEventListener("input", function (e) {
                        if (input.value.length === 1) {
                            let nextOneLeft = "tr_" + (rowIndex + 1) + "_" + colIndex;
                            if (document.querySelector("." + nextOneLeft).tagName === "DIV") {
                                nextOneLeft = "tr_" + rowIndex + "_" + (colIndex + 1);
                            }
                            document.querySelector("." + nextOneLeft).focus();
                        }
                    });
                }
                input.classList.add("tr_" + rowIndex + "_" + colIndex);

                td.appendChild(input);
                tr.appendChild(td);
            });
        });
    }

    function check() {
        items.forEach(function (row) {
            var a = 0
            row.forEach(function (oneLetter) {
                let valuen = document.querySelector(".tr_" + items.indexOf(row) + "_" + a)

                if (valuen.tagName !== "DIV") {

                    if (valuen.value == oneLetter) {
                        valuen.style.backgroundColor = "green"
                    } else {

                        valuen.style.backgroundColor = "red"
                    }
                }
                a++
            })

        })

    }
    function solve() {
        items.forEach(function (row) {
            var a = 0
            row.forEach(function (oneLetter) {
                let valuen = document.querySelector(".tr_" + items.indexOf(row) + "_" + a)

                if (valuen.tagName !== "DIV") {


               
                    valuen.value = oneLetter

                }
                a++
            })

        })

    }
</script>

<script>

</script>
<style>
    input {
        border-radius: 7px;
        text-align: center;
        border: 1.5px solid;
        width: 5vw;
        height: 5vw;
        font-size:  120%;
    }
td{
    width: 5vw;
        height: 5vw;
}
    .blank {

        display: inline-block;
       width: 5vw;
        height: 5vw;
    }
    button{
        width: 90px;
        height: 50px;
    }
</style>

</html>