<!DOCTYPE html>
<html lang="sl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Števec taroka</title>
</head>

<body>

    <button id="newgame" onclick="newGame()">Nova igra</button>
    <button id="game" onclick="Game()">Obstajajoča igra</button>
</body>

<script>
       
    function adaptColor(bg, txt) {
        document.body.style.setProperty('--bgColor', bg);
        document.body.style.setProperty('--colorTxt', txt)
        console.log("Colors" + bg + ", " + txt);
    }
    function addScore() {
        listOfPlayersCopy = JSON.parse(JSON.stringify(listOfPlayers));
        
        var newElement = document.createElement("div")
        newElement.setAttribute("class", "scrScreen");
        var iks = document.createElement("img")
        iks.classList.add("iks")
        iks.src = "https://raw.githubusercontent.com/google/material-design-icons/master/symbols/web/close/materialsymbolsrounded/close_grad200fill1_48px.svg"
        newElement.appendChild(iks)
    iks.addEventListener("click", function (e) {
            if (e.target == this){
                newElement.remove()
            }
        })
        
        var games = {  // "Ime igre": ["Koliko šteje igra","razlika","dobil true, ni dobil false", "s partnerjem, brez"]

            "Tri": [10, true, "", true],
            "Dve": [20, true, "", true],
            "Ena": [30, true, "", true],
            "Solo tri": [40, true, "", false],
            "Solo dve": [50, true, "", false],
            "Solo ena": [60, true, "", false],
            "Klop": ["", false, "", true],
            "Valat": [250, false, "", true],
            "Barvni Valat": [125, false, "", true],
            "Berač": [70, false, "", false],
            "Odprti Berač": [90, false, "", false],
            "Solo brez talona": [80, false, "", false],
            "Po meri": ["", false, "", true],
             "Dodaj radlce": ["", false, "", true]
        }
        for (const key in games) {
            let btn = document.createElement("button")
            btn.innerHTML = key
            btn.addEventListener("click", function () {
                newElement.remove()
                if (key == "Klop" || key == "Po meri") { klop(newElement,key ) } else { 
                  
                  if (key == "Dodaj radlce"){
                 
                    radlciDodaj()
                    document.querySelector(".cntScreen").remove()
            document.querySelector(".crezultLine").remove()
            newElement.remove()
            count()
                  }else {
                  calculate(key, games[key]) 
                  }
                  
                }
            })
            newElement.appendChild(btn)
        }
        document.body.appendChild(newElement)

    }
    

    function radlciDodaj() {
  for (const key in listOfPlayers) {
    
listOfPlayers[key][0] += "*"
    
  }
}

    function klop(newElement2, gamename) {
      
        var newElement = document.createElement("div")
        newElement.setAttribute("class", "scrScreen");
        document.body.appendChild(newElement)
        var iks = document.createElement("img")
        iks.classList.add("iks")
        iks.src = "https://raw.githubusercontent.com/google/material-design-icons/master/symbols/web/close/materialsymbolsrounded/close_grad200fill1_48px.svg"
        newElement.appendChild(iks)
      iks.addEventListener("click", function (e) {
            if (e.target == this){
                newElement.remove()
            }
        })
        for (const user in listOfPlayers) {
            let klopPlayer = document.createElement("input")
            klopPlayer.classList.add("klopPlayer")
            klopPlayer.type = "number"
            klopPlayer.min = 0
            klopPlayer.name = user
            klopPlayer.placeholder = "Točke osebe " + user + "..."
            newElement.appendChild(klopPlayer)



        }
        var btn = document.createElement("button")
        btn.innerHTML = "Končano"
        let lnbrk = document.createElement("div")
        lnbrk.classList.add("break")
        newElement.appendChild(lnbrk)
        newElement.appendChild(btn)
        btn.addEventListener("click", function () {
            if (Array.from(document.querySelectorAll('.klopPlayer')).every(input => input.type === 'submit' || input.value.trim() !== '')) {
            var plNombers = document.getElementsByClassName("klopPlayer");
            for (var i = 0; i < plNombers.length; i++) {
                if(gamename == "Klop"){
                
                  if (plNombers[i].value > 0){
                    radlciDodaj()
                      
               plusScore(plNombers[i].name, -Math.abs(parseInt(plNombers[i].value)))}else{
                 plusScore(plNombers[i].name, 0)
                }
                }
                else{
                    plusScore(plNombers[i].name,parseInt(plNombers[i].value))
                }
            }
            newElement.remove()
            newElement2.remove()
            document.querySelector(".cntScreen").remove()
            document.querySelector(".crezultLine").remove()
            count()
         }
        })
        
    }

    function calculate(gameName, properties) {
        var btn = document.createElement("button")
        var btn2 = document.createElement("button")
        var points = properties[0]
        var razlikaTF = properties[1]
        var teamWork = properties[3]
        var newElement = document.createElement("div")
        newElement.setAttribute("class", "scrScreen");
        var iks = document.createElement("img")
        iks.classList.add("iks")
        iks.src = "https://raw.githubusercontent.com/google/material-design-icons/master/symbols/web/close/materialsymbolsrounded/close_grad200fill1_48px.svg"
        newElement.appendChild(iks)
        iks.addEventListener("click", function (e) {
            if (e.target == this){
                newElement.remove()
            }
        })
        document.body.appendChild(newElement)
if(gameName.includes('Valat') || gameName.includes('Berač') ) {radlciDodaj()}
        if (teamWork) {

            btn.innerHTML = "Sam"
            btn2.innerHTML = "S partnerjem"
            newElement.appendChild(btn)
            newElement.appendChild(btn2)

        } else {
            alone(newElement, gameName, properties)
        }


        btn.addEventListener("click", function () {

            this.remove();
            btn2.remove();

            alone(newElement, gameName, properties)
        })

        btn2.addEventListener("click", function () {
            btn.remove(); btn2.remove();
            partner(newElement, gameName, properties)


        })



    }

    function alone(newElement, gameName, properties) {
        var difNu = document.createElement("input")
        if (properties[1]) {

            difNu.type = "number"
            difNu.min = 0
            difNu.placeholder = "Razlika..."
            difNu.max = 34
            newElement.appendChild(difNu)
            difNu.focus()
            var razlika
            difNu.addEventListener("change", function () {
                razlika = difNu.value
                let nearestMultipleOf5 = Math.round(razlika / 5) * 5;
                razlika = nearestMultipleOf5;
            })
        }
        let lnbrk = document.createElement("div")
        lnbrk.classList.add("break")
        newElement.appendChild(lnbrk)
        var btn22 = document.createElement("button")
        var btn23 = document.createElement("button")
        var slct = document.createElement("select")
        for (const user in listOfPlayers) {
            slct.innerHTML += "<option>" + user + "</option>"
        }

        newElement.appendChild(slct)
        let lnbrk2 = document.createElement("div")
        lnbrk2.classList.add("break")
        newElement.appendChild(lnbrk2)
        newElement.appendChild(document.createElement("br"))
        btn22.innerHTML = "Zmagal"
        btn23.innerHTML = "Izgubil"
        newElement.appendChild(btn22)
        newElement.appendChild(btn23)
        document.body.appendChild(newElement)

        btn22.addEventListener("click", function () {
            if (difNu.value !== "" || properties[1] == false) {
                let nearestMultipleOf5 = Math.round(razlika / 5) * 5;
                razlika = nearestMultipleOf5;
                this.remove();
                btn23.remove();
                if (properties[1]) {
                    aloneplusScore(slct.value,parseInt(properties[0]) + parseInt(razlika), true)
                } else {
                    aloneplusScore(slct.value,parseInt(properties[0]), true)
                }
                newElement.remove()
                
            }
        })
        btn23.addEventListener("click", function () {
            if (difNu.value !== "" || properties[1] == false) {
                let nearestMultipleOf5 = Math.round(razlika / 5) * 5;
                razlika = nearestMultipleOf5;
                this.remove();
                btn23.remove();
                if (properties[1]) {
                    aloneplusScore(slct.value,-Math.abs((parseInt(properties[0]) + parseInt(razlika))), true)
                } else {
                    aloneplusScore(slct.value,-Math.abs(parseInt(properties[0])), true)
                }

                newElement.remove()
               
            }
        })


    }
    function partner(newElement, gameName, properties) {

        var difNu = document.createElement("input")
        if (properties[1]) {

            difNu.type = "number"
            difNu.min = 0
            difNu.placeholder = "Razlika..."
            difNu.max = 34
            newElement.appendChild(difNu)
            difNu.focus()
            var razlika
            difNu.addEventListener("change", function () {
                razlika = difNu.value
                let nearestMultipleOf5 = Math.round(razlika / 5) * 5;
                difNu.value = nearestMultipleOf5;
            })
        }

        let lnbrk = document.createElement("div")
        lnbrk.classList.add("break")
        newElement.appendChild(lnbrk)
        var btn22 = document.createElement("button")
        var btn23 = document.createElement("button")
        var slct = document.createElement("select")
        var slct2 = document.createElement("select")
        slct2.innerHTML= "<option>Partner</option>"  
slct.innerHTML= "<option>Glavni igralec</option>"  
        for (const user in listOfPlayers) {
            slct.innerHTML += "<option>" + user + "</option>"
            slct2.innerHTML += "<option>" + user + "</option>"
        }

        newElement.appendChild(slct)
        newElement.appendChild(slct2)
        let lnbrk2 = document.createElement("div")
        lnbrk2.classList.add("break")
        newElement.appendChild(lnbrk2)
        newElement.appendChild(document.createElement("br"))
        btn22.innerHTML = "Zmagal"
        btn23.innerHTML = "Izgubil"
        newElement.appendChild(btn22)
        newElement.appendChild(btn23)
        document.body.appendChild(newElement)


        btn22.addEventListener("click", function () {
        
          
            if (difNu.value !== "" || properties[18] == false) {
              if( slct.selectedIndex !== 0  && slct2.selectedIndex !== 0){
                let nearestMultipleOf5 = Math.round(razlika / 5) * 5;
                razlika = nearestMultipleOf5;
                this.remove();
                btn23.remove();
                if (properties[1]) {
                    plusScore(slct.value,slct2.value  ,parseInt(properties[0] + parseInt(razlika)))
                } else {
                    plusScore(slct.value,slct2.value  ,parseInt(properties[0]))
                }
                document.querySelector(".cntScreen").remove()
            document.querySelector(".crezultLine").remove()
            
            count()
                newElement.remove()
                
            }} 
        })
        btn23.addEventListener("click", function () {

            if (difNu.value !== "" || properties[1] == false) {
              if( slct.selectedIndex !== 0  && slct2.selectedIndex !== 0){
                let nearestMultipleOf5 = Math.round(razlika / 5) * 5;
                razlika = nearestMultipleOf5;
                this.remove();
                btn23.remove();
                if (properties[1]) {
                    plusScore(slct.value,slct2.value  ,-Math.abs(parseInt(properties[0] + parseInt(razlika))))
                } else {
                 plusScore(slct.value,slct2.value  ,-Math.abs(parseInt(properties[0])))
                   
                }
document.querySelector(".cntScreen").remove()
document.querySelector(".crezultLine").remove()

count()
                newElement.remove()
                
            }}
        })

    }
function plusScore(playedUser,user, score){
  if(playedUser[0].length > 0){
  listOfPlayers[user].push(score*2)
listOfPlayers[playedUser].push(score*2)
  if (score>0){
    console.log('+_+_++€+€')
  listOfPlayers[playedUser][0]=listOfPlayers[playedUser][0].replace('*', '')
  }else{
    listOfPlayers[user].push(score)
    listOfPlayers[playedUser].push(score)
  }
  
}
}
  function aloneplusScore(user, score){
  if(user[0].length > 0){
  listOfPlayers[user].push(score*2)
  if (score>0){
listOfPlayers[playedUser][0]=  listOfPlayers[user][0].replace('*', '')
  }else{
    listOfPlayers[user].push(score)
  }
  document.querySelector(".cntScreen").remove()
            document.querySelector(".crezultLine").remove()
            
            count()
}
}

    function Game() {

        var newElement = document.createElement("div")
        newElement.setAttribute("class", "whlScreen");
        var iks = document.createElement("img")
        iks.classList.add("iks")
        iks.src = "https://raw.githubusercontent.com/google/material-design-icons/master/symbols/web/close/materialsymbolsrounded/close_grad200fill1_48px.svg"
        newElement.appendChild(iks)
        iks.addEventListener("click", function (e) {
            if (e.target == this){
                newElement.remove()
            }
        })
       
        var slct = document.createElement("select")
        slct.innerHTML += "<option>Select</option>"
     
        document.body.appendChild(newElement)
        for (var i = 0; i < localStorage.length; i++) {
            let user = Object.keys(localStorage)[i];
            
            slct.innerHTML += "<option>" + user + "</option>"
        }
        newElement.appendChild(slct)
        slct.addEventListener("change", function () {
            if (slct.value !== "Select") {
                listOfPlayers = JSON.parse(localStorage[slct.value])
                newElement.remove()
                listOfPlayersCopy = JSON.parse(JSON.stringify(listOfPlayers));
                
                count()

            }
        })
    }
    function undo() {
        listOfPlayers = JSON.parse(JSON.stringify(listOfPlayersCopy));
        document.querySelector(".cntScreen").remove()
        count()
    }
    var listOfPlayers = {}
    var listOfPlayersCopy = {}
    function newGame() {
    

        var newElement = document.createElement("div")
        newElement.setAttribute("class", "whlScreen");
        var iks = document.createElement("img")
        iks.classList.add("iks")
        iks.src = "https://raw.githubusercontent.com/google/material-design-icons/master/symbols/web/close/materialsymbolsrounded/close_grad200fill1_48px.svg"
        iks.addEventListener("click", function (e) {
            if (e.target == this){
                newElement.remove()
            }
        })
        newElement.appendChild(iks)
        var onePl = document.createElement("input")
        var newPl = document.createElement("button")
        var endPl = document.createElement("button")
        newPl.setAttribute("id", "addPlayer");
        newPl.innerHTML = "Add player"
        newPl.setAttribute("class", "child");
        onePl.setAttribute("class", "child");
        onePl.placeholder = "Ime..."
        endPl.setAttribute("class", "child");
        endPl.innerHTML = "Confirm"
        newElement.appendChild(onePl)
        onePl.focus()
        newElement.appendChild(newPl)
        newElement.appendChild(endPl)
        document.body.appendChild(newElement)
        newPl.addEventListener("click", function () {
            let onePl2 = document.createElement("input")
            onePl2.setAttribute("class", "child");
            onePl2.placeholder = "Ime..."
            newElement.appendChild(onePl2)
            newElement.insertBefore(onePl2, newPl);
            onePl2.focus()
        })
        endPl.addEventListener("click", function () {
            for (var i = 0; i < document.getElementsByTagName('input').length; i++) {
                let input = document.getElementsByTagName('input')[i].value
                listOfPlayers[input] = []
            }
            newElement.style.display = "none"
            
            localStorage.setItem(JSON.stringify(Object.keys(listOfPlayers)).replace(/"/g, '').replace("[", "").replace("]", "").replace(/,/g, ", "), JSON.stringify(listOfPlayers))
            listOfPlayersCopy = JSON.parse(JSON.stringify(listOfPlayers));
            count()

        })


    }

    function count() {
      
     

      
        localStorage.setItem(JSON.stringify(Object.keys(listOfPlayers)).replace(/"/g, '').replace("[", "").replace("]", "").replace(/,/g, ", "), JSON.stringify(listOfPlayers))
        document.getElementById("newgame").style.display = "none"
        document.getElementById("game").style.display = "none"
        var newElement = document.createElement("div")
        newElement.setAttribute("class", "cntScreen");
        newElement.addEventListener("click", function () { addScore() })
        if (JSON.stringify(listOfPlayers) !== JSON.stringify(listOfPlayersCopy)) {
            var btn22 = document.createElement("button")
            btn22.innerHTML = "Nazaj"
            btn22.classList.add("undo")

            document.body.appendChild(btn22)
            btn22.addEventListener("click", function () {
                undo()
            })
            btn22.remove()
        }
        var rezultLine = document.createElement("div")
        for (const key in listOfPlayers) {
          
            let name = key
            if( listOfPlayers[key][1] +1 == NaN){
         listOfPlayers[key].unshift(' ')
           console.log("ggg")
            }
            let pnts = listOfPlayers[key]
            var pljr = document.createElement("div")
            let i = 1
            let points = 0
  pljr.innerHTML = '<p style="padding-bottom: 10px;box-shadow:  12px -9px 20px #000;z-index:5555;border-bottom: 1px solid; overflow: hidden;  position: sticky; top: 0px; background-color: var(--bgColor); padding-top: 20px;margin-top: -50px;">' + name +listOfPlayers[key][0]+'</p>'
pljr.innerHTML= String(pljr.innerHTML).replace('undefined', '')      ;   
    pljr.innerHTML += '<p style=  "" >&nbsp</p>'
            while (i < pnts.length) {
                pljr.innerHTML += '<p style=  "" >' + pnts[i] + '</p>'
                points += pnts[i]
                i++
            }

            pljr.innerHTML += '<p style=  "" >&nbsp</p>'

            pljr.setAttribute("class", "chl");
            pljr.style.display = "inline-block;"
            rezultLine.innerHTML += '<p  style="flex:1;border-right: 1px solid; " >' + points + '</p>'
            newElement.appendChild(pljr)
        }
        rezultLine.setAttribute("class", "crezultLine");
        document.body.appendChild(rezultLine)
        document.body.appendChild(newElement)


    }

  






</script>

<style>
    .iks {
    position: fixed;
    right: 10px;
    top: 10px;
}
    #newgame {
        position: absolute;
        top: 40%;
        left: 50%;
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
    }

    #game {
        position: absolute;
        top: 60%;
        left: 50%;
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
    }

    .undo {
        position: fixed;
        right: 10px;
        bottom: 50px;
    }

    .break {
        flex-basis: 100%;
        height: 0;
    }

    .chl {
        color: var(--colorTxt);
        min-height: 100vh;
        height: auto;
        flex: 1;
        text-align: center;
        font-size: large;
        border-right: 1px solid;
    }

    .chl2 {
        flex: 1;
        text-align: center;
        font-size: large;
        position: absolute;
        bottom: 0;
        border-right: 1px solid;
    }

    .chl::after {
        content: '';

        height: 55vh;
        position: fixed;
        justify-content: center;
        /* right: -12.1vw; */
        display: none;
        width: 1px;
        overflow: hidden;
        top: 25vh;
        background-color: #000000;
    }

    .whlScreen {
        color: var(--colorTxt);
        z-index: 500000;
        display: flex;
        flex-direction: column;
        width: 100%;
        top: 0;
        position: absolute;
        justify-content: center;
        align-items: center;
        height: 100%;
        backdrop-filter: blur(5px);
    }

    button:active {
        box-shadow: 0px 0px #888888;
    }

    button {
        color: var(--colorTxt);
        transition: all .05s;
        position: relative;
        flex-basis: 100px;
        border-radius: 30px;
        border-width: 0;
        background-color: var(--bgColor);
        box-shadow: 5px 5px #888888;
        margin: 10px;
        height: 40px;
    }

    select:active {
        box-shadow: 0px 0px #888888;
        border-width: 0;
    }

    select {
        transition: all .05s;
        margin: 30px;
        width: 40vw;
        border-width: 0;
        border-radius: 20px;
        padding: 7px;
        box-shadow: 5px 5px #888888;
    }

    input {
        margin: 30px;
        width: 40vw;
        border-width: 0;
        border-radius: 20px;
        padding: 7px;
        box-shadow: 5px 5px #888888;
    }

    .scrScreen {
      animation: showScreen .4s forwards;
        color: var(--colorTxt);
        z-index: 500000;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        width: 100%;
        top: 0;
        position: fixed;
        justify-content: center;
        align-content: center;
        height: 100%;
        backdrop-filter: blur(5px);
    }

    .cntScreen {
      animation: showScreen .4s forwards;
        color: var(--colorTxt);
        display: flex;
        flex-direction: row;
        width: 100%;
        top: 0;

        justify-content: center;
        align-items: top;
        height: 100%;

    }
    .crezultLine {
        color: var(--colorTxt);
        box-shadow: 0px 10px 20px #000;
        background-color: var(--bgColor);
        z-index: 400;
        overflow: hidden;
        display: flex;
        flex-direction: row;
        width: 100%;
        bottom: 0;
        position: fixed;
        justify-content: center;
        align-items: top;
        text-align: center;
        border-top: 1px solid;
    }

    .child {
        width: 30vw;
        margin: 10px;
    }

    body {
        --bgColor: #DCB585;
        --colorTxt: rgb(0, 0, 0);
        color: var(--colorTxt);
        margin: 0;
        background-attachment: fixed;
        background-color: var(--bgColor);
        
    }
    @keyframes showScreen{
      0%{opacity:0;scale:.2;backdrop-filter: blur(0)}
      80%{opacity:1; scale:1.05;}
       100%{opacity:1; scale:1;backdrop-filter: blur(5px)}
    }
</style>

</html>
