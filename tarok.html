<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Števec taroka</title>
</head>

<body>
    <button id="newgame" onclick="newGame()">New game</button>
    <button id="game" onclick="Game()"> Existing game</button>
</body>

<script>
function addScore(){

    var newElement = document.createElement("div")
        newElement.setAttribute("class", "scrScreen");
        var games = {  // "Ime igre": ["Koliko šteje igra","razlika","dobil true, ni dobil false", "s partnerjem, brez"]
           
            "Tri": [10, true,"", true],
            "Dve": [20, true,"", true],
            "Ena": [30, true,"", true],
            "Solo tri": [40, true,"", false],
            "Solo dve": [50, true,"", false],
            "Solo ena": [60, true,"", false],
            "Valat": [250, false,"", true],
            "Barvni valat": [125, false,"", true],
            "Berač":[70, false,"", false],
            "Odprti berač":[90, false,"", false],
            "Solo brez talona": [80, true, "", false],
        }
        for(const key in games){
                let btn  = document.createElement("button")
                btn.innerHTML = key
                btn.addEventListener("click", function () {newElement.remove();calculate(key, games[key])})
                newElement.appendChild(btn)
        }
        document.body.appendChild(newElement)

}

function calculate(gameName, properties){
    var btn  = document.createElement("button")
    var btn2  = document.createElement("button")
var points = properties[0]
var razlikaTF = properties[1]
var teamWork = properties[3]
var newElement = document.createElement("div")
        newElement.setAttribute("class", "scrScreen");
document.body.appendChild(newElement)

if(teamWork){
   
    btn.innerHTML = "Sam"
    btn2.innerHTML = "S partnerjem"
    newElement.appendChild(btn)
    newElement.appendChild(btn2)
 
} else{
    alone(newElement, gameName, properties)
}


btn.addEventListener("click", function () {

    this.remove();
    btn2.remove();

   alone(newElement, gameName, properties)
})

     btn2.addEventListener("click", function () {btn.remove();btn2.remove();
      partner(newElement, gameName, properties)
    
    
    })



}

function alone(newElement, gameName, properties){

    if(properties[1]){
        var razlika = prompt("Koliko je bilo razlike")
    }
    
    var btn22  = document.createElement("button")
   var btn23  = document.createElement("button")
   var slct = document.createElement("select")
   for(const user in listOfPlayers){
    slct.innerHTML += "<option>"+user+"</option>"
   }
   newElement.appendChild(slct)

   newElement.appendChild( document.createElement("br"))
    btn22.innerHTML = "Zmagal"
    btn23.innerHTML = "Izgubil"
    newElement.appendChild(btn22)
    newElement.appendChild(btn23)
    document.body.appendChild(newElement)

    btn22.addEventListener("click", function () {

this.remove();
btn23.remove();
if(properties[1]){
    listOfPlayers[slct.value].push(parseInt(properties[0])+parseInt(razlika))
    }else{
        listOfPlayers[slct.value].push(parseInt(properties[0]))
    }
newElement.remove()
document.querySelector(".cntScreen").remove()
count()
})
btn23.addEventListener("click", function () {

this.remove();
btn23.remove();
if(properties[1]){
    listOfPlayers[slct.value].push(-Math.abs((parseInt(properties[0])+parseInt(razlika))))
    }else{
        listOfPlayers[slct.value].push(-Math.abs(parseInt(properties[0])))
    }

newElement.remove()
document.querySelector(".cntScreen").remove()
count()
})

}
function partner(newElement, gameName, properties){

if(properties[1]){
    var razlika = prompt("Koliko je bilo razlike")
}

var btn22  = document.createElement("button")
var btn23  = document.createElement("button")
var slct = document.createElement("select")
for(const user in listOfPlayers){
slct.innerHTML += "<option>"+user+"</option>"
}
var slct2 = document.createElement("select")
for(const user in listOfPlayers){
slct2.innerHTML += "<option>"+user+"</option>"
}

newElement.appendChild(slct2)
newElement.appendChild(slct)
newElement.appendChild( document.createElement("br"))
btn22.innerHTML = "Zmagal"
btn23.innerHTML = "Izgubil"
newElement.appendChild(btn22)
newElement.appendChild(btn23)
document.body.appendChild(newElement)

btn22.addEventListener("click", function () {

this.remove();
btn23.remove();
if(properties[1]){
listOfPlayers[slct.value].push(parseInt(properties[0])+parseInt(razlika))
listOfPlayers[slct2.value].push(parseInt(properties[0])+parseInt(razlika))
}else{
    listOfPlayers[slct.value].push(parseInt(properties[0]))
    listOfPlayers[slct2.value].push(parseInt(properties[0]))
}
newElement.remove()
document.querySelector(".cntScreen").remove()
count()
})
btn23.addEventListener("click", function () {

this.remove();
btn23.remove();
if(properties[1]){
listOfPlayers[slct.value].push(-Math.abs((parseInt(properties[0])+parseInt(razlika))))
listOfPlayers[slct2.value].push(-Math.abs((parseInt(properties[0])+parseInt(razlika))))
}else{
    listOfPlayers[slct.value].push(-Math.abs(parseInt(properties[0])))
    listOfPlayers[slct2.value].push(-Math.abs(parseInt(properties[0])))
}

newElement.remove()
document.querySelector(".cntScreen").remove()
count()
})

}

    function Game() {
        var newElement = document.createElement("div")
        newElement.setAttribute("class", "whlScreen");
    
        var slct = document.createElement("select")
        document.body.appendChild(newElement)
for(const user in localStorage){
slct.innerHTML += "<option>"+user+"</option>"
}
newElement.appendChild(slct)
slct.addEventListener("change", function () {
    listOfPlayers =  JSON.parse(localStorage[slct.value])
    newElement.remove()
        count()
})
    }
    var listOfPlayers = {}
    function newGame() {
        var newElement = document.createElement("div")
        newElement.setAttribute("class", "whlScreen");
        var onePl = document.createElement("input")
        var newPl = document.createElement("button")
        var endPl = document.createElement("button")
        newPl.setAttribute("id", "addPlayer");
        newPl.innerHTML = "Add player"
        newPl.setAttribute("class", "child");
        onePl.setAttribute("class", "child");
        endPl.setAttribute("class", "child");
        endPl.innerHTML = "Confirm"
        newElement.appendChild(onePl)
        newElement.appendChild(newPl)
        newElement.appendChild(endPl)
        document.body.appendChild(newElement)
        newPl.addEventListener("click", function () {
            let onePl2 = document.createElement("input")
            onePl2.setAttribute("class", "child");
            newElement.appendChild(onePl2)
            newElement.insertBefore(onePl2, newPl);
        })
        endPl.addEventListener("click", function () {
            for (var i = 0; i < document.getElementsByTagName('input').length; i++) {
                let input = document.getElementsByTagName('input')[i].value
                listOfPlayers[input] = []
            }
            newElement.style.display = "none"
            console.log(listOfPlayers);
            localStorage.setItem(JSON.stringify(Object.keys(listOfPlayers)).replace(/"/g, ''), JSON.stringify(listOfPlayers))
            count()
        })


    }

    function count() {
        localStorage.setItem(JSON.stringify(Object.keys(listOfPlayers)).replace(/"/g, ''), JSON.stringify(listOfPlayers))
        document.getElementById("newgame").style.display = "none"
        document.getElementById("game").style.display = "none"
        var newElement = document.createElement("div")
        newElement.setAttribute("class", "cntScreen");
        newElement.addEventListener("click", function () {addScore()})
       
        var rezultLine = document.createElement("div")
        for (const key in listOfPlayers) {
            let name = key
            let pnts = listOfPlayers[key]
            var pljr = document.createElement("div")
            let i = 0
            let points = 0
            
            pljr.innerHTML = '<p style="z-index:5555;border-bottom: 1px solid; overflow: hidden;  position: sticky; top: 0px; background: #DCB585; padding-top: 20px;margin-top: -50px;">' + name + '</p>'
            pljr.innerHTML += '<p style=  "backdrop-filter: blur(5px);" >&nbsp</p>'
            while (i < pnts.length) {
                pljr.innerHTML += '<p style=  "" >' + pnts[i] + '</p>'
                points += pnts[i]
                i++
            }
          
            pljr.innerHTML += '<p style=  "backdrop-filter: blur(5px);" >&nbsp</p>'
            
            pljr.setAttribute("class", "chl");
            pljr.style.display = "inline-block;"
            rezultLine.innerHTML += '<p  style="flex:1; " >' + points + '</p>'
            newElement.appendChild(pljr) 
        }
       rezultLine.setAttribute("class", "crezultLine");
       document.body.appendChild(rezultLine)
        document.body.appendChild(newElement)

    }




</script>

<style>
    .chl {
        flex: 1;
        text-align: center;
        font-size: large;
        border-right: 1px solid;
    }

    .chl2 {
        flex: 1;
        text-align: center;
        font-size: large;
        position: absolute;
        bottom: 0;
        border-right: 1px solid;
    }

    .whlScreen {
        z-index: 500000;
        display: flex;
        flex-direction: column;
        width: 100%;
        top: 0;
        position: absolute;
        justify-content: center;
        align-items: center;
        height: 100%;
        backdrop-filter: blur(5px);
    }
    .scrScreen > button { 
        position: relative;
    flex-basis: 100px;
    border-radius: 30px;
    border-width: 0;
    background-color: #DCB585;
    box-shadow: 5px 5px #888888;
  margin: 10px;
    height: 40px;
} 
    .scrScreen {
        z-index: 500000;
        display: flex;
        flex-direction:row;
        flex-wrap: wrap;
        width: 100%;
        top: 0;
        position: absolute;
        justify-content: center;
        align-content: center;
        height: 100%;
        backdrop-filter: blur(5px);
    }

    .cntScreen {
        display: flex;
        flex-direction: row;
        width: 100%;
        top: 0;
      
        justify-content: center;
        align-items: top;
        height: 100%;
       
    }
    .crezultLine {
        background: #DCB585;
        z-index: 400;
        overflow: hidden;
    display: flex;
    flex-direction: row;
    width: 100%;
    bottom: 0;
    position: fixed;
    justify-content: center;
    align-items: top;
    text-align: center;
    border-top: 1px solid;
    }

    .child {
        width: 30vw;
        margin: 10px;
    }

    body {
        background-attachment:fixed;
        background: #DCB585 url("https://valat.si/assets/images/wood.webp");
    }
</style>

</html>